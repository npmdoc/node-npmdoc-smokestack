<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/hughsk/smokestack"

    >smokestack (v3.4.1)</a>
</h1>
<h4>Pipe your JavaScript into a browser, logging console output in Node</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.smokestack">module smokestack</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.smokestack.smokestack">
            function <span class="apidocSignatureSpan"></span>smokestack
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.smokestack" id="apidoc.module.smokestack">module smokestack</a></h1>


    <h2>
        <a href="#apidoc.element.smokestack.smokestack" id="apidoc.element.smokestack.smokestack">
        function <span class="apidocSignatureSpan"></span>smokestack
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function smokestack(opts) {
  opts = opts || {}

  var browser   = opts.browser || &#x27;chrome&#x27;
  var saucelabs = !!opts.saucelabs || process.env.SAUCE
  var sauceUser = opts.sauceUsername || process.env.SAUCE_USERNAME
  var sauceKey  = opts.sauceKey || process.env.SAUCE_ACCESS_KEY

  var tunneller = null
  var launched = null
  var sauce = null
  var interval = null

  var listen = false
  var script = false

  var stream = through(write, flush)
  var server = createServer()
  var port   = opts.port || 0
  var buffer = []

  server.listen(port, function(err) {
    stream.emit(&#x27;listen&#x27;, server)
    port = server.address().port
    if (err) return stream.emit(&#x27;error&#x27;, err)
    debug(&#x27;http://localhost:&#x27;+port+&#x27;/&#x27;)
    listen = true
    if (script) return open()
  })

  shoe(function(browser) {
    stream.emit(&#x27;connect&#x27;, browser)
    var handle = through(handleInput)

    browser
      .pipe(split())
      .pipe(handle)
      .once(&#x27;close&#x27;, stream.shutdown)
      .pipe(browser)
  }).install(server, &#x27;/smokestack&#x27;)

  function handleInput(data, _, next) {
    var self = this
    data = JSON.parse(String(data))

    if (data.end) {
      this.push(&#x27;end\n&#x27;)

      return setTimeout(function() {
        if (self.writable) self.push(null)
      }, 1000)
    }

    data.shift() // remove prefix/key e.g. log/error/warn
    stream.push(data + &#x27;\n&#x27;)
    next()
  }

  stream.shutdown = function shutdown(fn) {
    if (typeof fn !== &#x27;function&#x27;) fn = false

    // ensure shutdown only called once
    if (shutdown.called) return fn &#x26;&#x26; fn(); shutdown.called = true
    if (launched) launched.removeListener(&#x27;exit&#x27;, stream.shutdown)
    process.removeListener(&#x27;exit&#x27;, stream.shutdown)
    process.removeListener(&#x27;close&#x27;, stream.shutdown)

    debug(&#x27;Shutting down!&#x27;)

    // stop the &#x22;ping&#x22; interval
    if (interval) {
      clearInterval(interval)
    }

    // kill child if necessary
    if (launched &#x26;&#x26; !launched.killed) {
      debug(&#x27;Killing child process&#x27;)
      launched.once(&#x27;close&#x27;, next)
      launched.kill()
    } else {
      if (tunneller) tunneller.close()
      if (sauce) {
        debug(&#x27;Disconnecting browser session, closing tunnel&#x27;)
        sauce.quit(next)
      } else {
        next()
      }
    }

    function next() {
      // closing server if necessary
      debug(&#x27;Shutting down host server&#x27;)
      server._handle ? server.close(next) : next()

      function next() {
        stream.emit(&#x27;end&#x27;)
        stream.emit(&#x27;close&#x27;)
        process.nextTick(function() {
          stream.emit(&#x27;finish&#x27;)
          stream.emit(&#x27;shutdown&#x27;)
          debug(&#x27;Shutdown complete&#x27;)
          fn &#x26;&#x26; fn()
        })
      }
    }
  }

  return stream

  function write(data, _, next) {
    buffer.push(data)
    next()
  }

  function flush() {
    server.updateBuffer(buffer)
    script = true
    if (listen) return open()
  }

  function open() {
    return saucelabs
      ? launchRemote()
      : launchBrowser()
  }

  function launchRemote() {
    debug(&#x27;Launching remote test, using http://localtunnel.me&#x27;)

    tunnel(port, {
      host: &#x27;http://localtunnel.me/&#x27;
    }, function(err, _tunneller) {
      if (err) return stream.emit(&#x27;error&#x27;, err)
      debug(&#x27;localtunnel URL: %s&#x27;, (tunneller = _tunneller).url)

      var hostname = &#x27;ondemand.saucelabs.com&#x27;
      var hostport = 80
      var user     = sauceUser
      var key      = sauceKey
      var config   = {
          browserName: browser
        , platform: &#x27;MAC&#x27;
        , javascriptEnabled: true
        , takeScreenshot: true
      }

      if (!user) return stream.emit(&#x27;error&#x27;, new Error(&#x27;No username provided for saucelabs&#x27;))
      if (!key) return stream.emit(&#x27;error&#x27;, new Error(&#x27;No access key provided for saucelabs&#x27;))

      debug(&#x27;Connecting to %s&#x27;, hostname)
      debug(&#x27;Username: %s&#x27;, user)
      debug(&#x27;API Key: %s&#x27;, key)
      debug(&#x27;Config: %o&#x27;, config)

      sauce = wd.remote(hostname, hostport, user, key)
      sauce.init(config, function(err) {
        if (err) return stream.emit(&#x27;error&#x27;, err)

        debug(&#x27;Connection established&#x27;)
        debug(&#x27;Hitting %s&#x27;, tunneller.url)

        sa ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
